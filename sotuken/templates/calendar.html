<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MovieShift カレンダー</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ✅ キャッシュ無効化 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MovieShift カレンダー</title>
    ...
  </head>
</head>
<body>
  <div class="user-info">
    <p>{{ store_id }}号店 {{ user_name }}さん</p>
  </div>
  <h1 id="monthYear">希望スケジュール入力</h1>

  <!-- 月切り替え -->
  <div class="month-switch">
    <button id="prevMonth">← 前の月</button>
    <button id="nextMonth">次の月 →</button>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  {% endwith %}


  <!-- カレンダー -->
  <table class="calendar" id="calendar">
    <thead>
      <tr>
        <th>日</th>
        <th>月</th>
        <th>火</th>
        <th>水</th>
        <th>木</th>
        <th>金</th>
        <th>土</th>
      </tr>
    </thead>
    <tbody id="calendar-body"></tbody>
  </table>

  <script id="sentDatesData" type="application/json">
    {{ sent_dates | tojson | safe }}
  </script>

  <!-- ボトムナビゲーション（追加） -->
  <nav class="bottom-nav">
    <a href="#" class="nav-item active" id="nav-calendar">
      <div class="nav-icon icon-calendar"></div>
      <span class="nav-label">カレンダー</span>
    </a>
    
    <a href="{{ url_for('calendar.my_confirmed_shift') }}" class="nav-item active">
      <div class="nav-icon icon-check" style="position: relative;">
          {% if has_new_shift %}
          <span style="
              position: absolute;
              top: -5px;
              right: -8px;
              background-color: #ff3b30; /* 鮮やかな赤 */
              color: white;
              font-size: 10px;
              font-weight: bold;
              min-width: 16px;
              height: 16px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              border: 2px solid white; /* 境界をくっきりさせる */
              z-index: 10;
          ">1</span>
          {% endif %}
      </div>
      <span class="nav-label">確定シフト</span>
  </a>
    
    <a href="{{ url_for('chatbot.chat') }}" class="nav-item">
      <div class="nav-icon icon-chat"></div>
      <span class="nav-label">チャット</span>
    </a>
    
    <a href="{{ url_for('login.register_line_id') }}" class="nav-item">
      <div class="nav-icon icon-line"></div>
      <span class="nav-label">LINE登録</span>
    </a>
    
    <a href="#" class="nav-item" id="logout-link" data-logout-url="{{ url_for('login.logout') }}">
      <div class="nav-icon icon-logout"></div>
      <span class="nav-label">ログアウト</span>
    </a>
  </nav>

  <!-- ✅ calendar.js はこの下で読み込む -->
  <script src="{{ url_for('static', filename='js/calendar.js') }}"></script>

  <!-- ボトムナビゲーションのアクティブ状態切り替え（オプション） -->
  <script>
    // 現在のページに応じてアクティブ状態を切り替え
    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navItems = document.querySelectorAll('.nav-item');
      
      navItems.forEach(item => {
        if (item.getAttribute('href') === currentPath) {
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
        }
      });
    });
  </script>

</body>
</html>