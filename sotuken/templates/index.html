<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
    <script defer src="{{ url_for('static', filename='js/index.js') }}"></script>
    <title>AI ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</title>
</head>
<body>
    <header class="top-bar">
        <h1>ã‚¢ãƒ«ãƒã‚¤ãƒˆæ•™è‚²æ”¯æ´ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</h1>
    </header>

    <div class="chat-container" id="chat-container">
        {% if chat_history %}
            {% for msg in chat_history %}
                <div class="message {{ 'user' if msg.role == 'user' else 'bot' }}">
                    {{ msg.text }}
                    
                    {% if msg.role == 'bot' and loop.previtem and loop.previtem.role == 'user' %}
                        <button class="regen-btn" data-question="{{ loop.previtem.text }}">ğŸ”„å†ç”Ÿæˆ</button>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="message bot">ã“ã‚“ã«ã¡ã¯ï¼ã”è³ªå•ã‚’ã©ã†ã ğŸ˜Š</div>
        {% endif %}
    </div>

    <form id="chat-form" method="POST" action="/chatbot/">
        <input type="text" id="question" name="question" placeholder="è³ªå•ã‚’å…¥åŠ›..." required>
        <button type="submit">é€ä¿¡</button>
        <button type="button" id="clear-btn">å±¥æ­´ã‚’æ¶ˆã™</button>
    </form>

    <!-- ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="bottom-nav">
        <a href="{{ url_for('calendar.calendar') }}" class="nav-item">
            <div class="nav-icon icon-calendar"></div>
            <span class="nav-label">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</span>
        </a>
        
        <a href="{{ url_for('calendar.my_confirmed_shift') }}" class="nav-item active">
            <div class="nav-icon icon-check" style="position: relative;">
                {% if has_new_shift %}
                <span style="
                    position: absolute;
                    top: -5px;
                    right: -8px;
                    background-color: #ff3b30; /* é®®ã‚„ã‹ãªèµ¤ */
                    color: white;
                    font-size: 10px;
                    font-weight: bold;
                    min-width: 16px;
                    height: 16px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border: 2px solid white; /* å¢ƒç•Œã‚’ãã£ãã‚Šã•ã›ã‚‹ */
                    z-index: 10;
                ">1</span>
                {% endif %}
            </div>
            <span class="nav-label">ç¢ºå®šã‚·ãƒ•ãƒˆ</span>
        </a>
        
        <a href="{{ url_for('chatbot.chat') }}" class="nav-item active">
            <div class="nav-icon icon-chat"></div>
            <span class="nav-label">ãƒãƒ£ãƒƒãƒˆ</span>
        </a>
        
        <a href="{{ url_for('login.register_line_id') }}" class="nav-item">
            <div class="nav-icon icon-line"></div>
            <span class="nav-label">LINEç™»éŒ²</span>
        </a>
        
        <a href="#" class="nav-item" id="logout-link" data-logout-url="{{ url_for('login.logout') }}">
            <div class="nav-icon icon-logout"></div>
            <span class="nav-label">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
        </a>
    </nav>
</body>
</html>