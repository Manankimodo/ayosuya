<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='chatbot.css') }}">
    <title>AI ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</title>
</head>
<body>
    <!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ -->
    <div class="hamburger" id="hamburger">
        <span></span><span></span><span></span>
    </div>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <nav class="menu" id="menu">
        <ul>
        <li><a href="{{ url_for('calendar.calendar') }}">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a></li>
        </ul>
    </nav>

    <h1>ã‚¢ãƒ«ãƒã‚¤ãƒˆæ•™è‚²æ”¯æ´ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</h1>

    <!-- ğŸ’¬ ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ -->
    <div class="chat-container" id="chat-container">
        {% if question and answer %}
        <div class="message user">{{ question }}</div>
        <div class="message bot">{{ answer }}</div>
        {% else %}
        <div class="message bot">ã“ã‚“ã«ã¡ã¯ï¼ã”è³ªå•ã‚’ã©ã†ã ğŸ˜Š</div>
        {% endif %}
    </div>

    <!-- âœï¸ å…¥åŠ›æ¬„ -->
    <form id="chat-form" method="POST" action="/chatbot/">
        <input type="text" id="question" name="question" placeholder="è³ªå•ã‚’å…¥åŠ›..." required>
        <button type="submit">é€ä¿¡</button>
    </form>

    <script>
        // ğŸ” ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰
        document.getElementById('hamburger').addEventListener('click', () => {
        document.getElementById('hamburger').classList.toggle('active');
        document.getElementById('menu').classList.toggle('active');
        });

        // ğŸ’¬ ãƒãƒ£ãƒƒãƒˆé€ä¿¡å‡¦ç†ï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ï¼‰
        document.getElementById("chat-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const input = document.getElementById("question");
        const userText = input.value.trim();
        if (!userText) return;

        const chatContainer = document.getElementById("chat-container");

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        const userMsg = document.createElement("div");
        userMsg.className = "message user";
        userMsg.textContent = userText;
        chatContainer.appendChild(userMsg);

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
        input.value = "";

        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸‹ã¸
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡
        const response = await fetch("/chatbot/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ question: userText })
        });

        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        const answer = doc.querySelector(".message.bot")?.textContent || "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";

        // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        const botMsg = document.createElement("div");
        botMsg.className = "message bot";
        botMsg.textContent = answer;
        chatContainer.appendChild(botMsg);

        chatContainer.scrollTop = chatContainer.scrollHeight;
        });
    </script>
</body>
</html>
