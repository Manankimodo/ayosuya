<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç®¡ç†è€…ç”»é¢</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", "Hiragino Sans", sans-serif;
      margin: 40px;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    #controls {
      margin-bottom: 20px;
    }
    button {
      background-color: #3B82F6;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #2563EB;
    }
    #calendar {
      max-width: 900px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>ç®¡ç†è€…ãƒšãƒ¼ã‚¸</h1>

  <div id="controls">
    <button id="make-shift-btn">ğŸ—“ï¸ ã‚·ãƒ•ãƒˆè‡ªå‹•ä½œæˆ</button>
    <button onclick="location.href='/calendar/admin'">ğŸ‘¥ å‰ã®ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</button>
  </div>

  <div id="calendar"></div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆæœŸåŒ– ---
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ja',
      height: 'auto',
      events: '/makeshift/events',  // Flaskå´ã‹ã‚‰å–å¾—
      eventColor: '#3B82F6',
      eventDisplay: 'block',
      eventClick: function(info) {
        alert(info.event.title + "ï¼š " + info.event.startStr + "ã€œ" + info.event.endStr);
      }
    });
    calendar.render();

    // --- ã‚·ãƒ•ãƒˆä½œæˆãƒœã‚¿ãƒ³å‡¦ç† ---
    document.getElementById('make-shift-btn').addEventListener('click', async () => {
      if (!confirm("AIã§æ–°ã—ã„ã‚·ãƒ•ãƒˆã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ")) return;
      const res = await fetch('/makeshift/generate', { method: 'POST' });
      const data = await res.json();
      if (data.status === 'ok') {
        alert('ã‚·ãƒ•ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸï¼');
        calendar.refetchEvents(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°
      } else {
        alert('ã‚·ãƒ•ãƒˆä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    });
  });
  </script>
</body>
</html>
