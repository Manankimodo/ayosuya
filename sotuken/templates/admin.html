<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理者画面</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", "Hiragino Sans", sans-serif;
      margin: 40px;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    #controls {
      margin-bottom: 20px;
    }
    button {
      background-color: #3B82F6;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #2563EB;
    }
    #calendar {
      max-width: 900px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>管理者ページ</h1>

  <div id="controls">
    <button id="make-shift-btn">🗓️ シフト自動作成</button>
    <button onclick="location.href='/calendar/admin'">👥 前のページへ戻る</button>
  </div>

  <div id="calendar"></div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // --- カレンダー初期化 ---
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ja',
      height: 'auto',
      events: '/makeshift/events',  // Flask側から取得
      eventColor: '#3B82F6',
      eventDisplay: 'block',
      eventClick: function(info) {
        alert(info.event.title + "： " + info.event.startStr + "〜" + info.event.endStr);
      }
    });
    calendar.render();

    // --- シフト作成ボタン処理 ---
    document.getElementById('make-shift-btn').addEventListener('click', async () => {
      if (!confirm("AIで新しいシフトを作成しますか？")) return;
      const res = await fetch('/makeshift/generate', { method: 'POST' });
      const data = await res.json();
      if (data.status === 'ok') {
        alert('シフトを作成しました！');
        calendar.refetchEvents(); // カレンダー更新
      } else {
        alert('シフト作成に失敗しました。');
      }
    });
  });
  </script>
</body>
</html>
