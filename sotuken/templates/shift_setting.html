<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ã‚·ãƒ•ãƒˆè‡ªå‹•ç”Ÿæˆè¨­å®š</title>
  
  <style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f4f9; margin: 0; padding: 0; }
    
    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
    .menu-btn { position: fixed; top: 20px; left: 20px; z-index: 1001; cursor: pointer; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px; }
    .menu-btn span { display: block; width: 30px; height: 3px; background-color: #fff; margin: 6px 0; }
    
    /* ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .side-menu { position: fixed; top: 0; left: -250px; width: 250px; height: 100%; background-color: #333; transition: 0.3s; z-index: 1000; padding-top: 80px; }
    .side-menu.active { left: 0; }
    .side-menu ul { list-style: none; padding: 0; }
    .side-menu li a { display: block; padding: 15px 20px; color: #fff; text-decoration: none; border-bottom: 1px solid #444; }
    
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; padding-top: 80px; }

    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šçŸ¥ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã“ã“ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼‰ */
    .flash-message { padding: 15px; border-radius: 5px; margin-bottom: 10px; color: #fff; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    .flash-success { background-color: #4caf50; } /* ç·‘ */
    .flash-danger  { background-color: #f44336; } /* èµ¤ */
    .flash-info    { background-color: #2196f3; } /* é’ */

    /* ã‚¨ãƒªã‚¢ã‚«ãƒ¼ãƒ‰ */
    .time-zone-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .zone-card { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 5px solid #ccc; }
    .zone-morning { border-color: #4caf50; }
    .zone-lunch   { border-color: #ff9800; }
    .zone-idle    { border-color: #9e9e9e; }
    .zone-night   { border-color: #3f51b5; }

    .zone-title { font-weight: bold; font-size: 1.2em; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .form-row { margin-bottom: 10px; }
    .form-row label { display: block; font-size: 0.9em; color: #666; margin-bottom: 3px; }
    .form-row input, .form-row select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
    .add-btn { width: 100%; border: none; padding: 10px; color: white; font-weight: bold; border-radius: 4px; cursor: pointer; margin-top: 10px; }
    
    /* ãƒ†ãƒ¼ãƒ–ãƒ« */
    .demand-list { background: #fff; padding: 20px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
    th, td { border-bottom: 1px solid #eee; padding: 10px; text-align: left; }
    th { background: #f9f9f9; color: #555; }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const menuBtn = document.getElementById('menuBtn');
      const sideMenu = document.getElementById('sideMenu');
      if(menuBtn){
          menuBtn.onclick = () => sideMenu.classList.toggle('active');
          // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
          document.addEventListener('click', (e) => {
              if (!sideMenu.contains(e.target) && !menuBtn.contains(e.target)) {
                  sideMenu.classList.remove('active');
              }
          });
      }
    });
  </script>
</head>
<body>

  <div class="menu-btn" id="menuBtn"><span></span><span></span><span></span></div>
  
  <nav class="side-menu" id="sideMenu">
    <ul>
      <li><a href="{{ url_for('calendar.admin') }}">å¸Œæœ›ä¸€è¦§</a></li>
      <li><a href="{{ url_for('shift.manage_faq') }}">å±¥æ­´</a></li> 
      <li><a href="{{ url_for('makeshift.settings') }}">è¨­å®š</a></li>
      <li><a href="{{ url_for('insert.insert') }}">å¾“æ¥­å“¡ç™»éŒ²</a></li>
      <li><a href="{{ url_for('makeshift.generate_shift') }}">ã‚·ãƒ•ãƒˆä½œæˆ</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1>ğŸ›  å¿™ã—ã•ãƒ»å¿…è¦äººæ•°è¨­å®š</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div style="margin-bottom: 20px;">
          {% for category, msg in messages %}
            <div class="flash-message flash-{{ category if category in ['success', 'danger'] else 'info' }}">
              {{ msg }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <p style="color:#666; margin-bottom:20px;">æ™‚é–“å¸¯ã”ã¨ã«å¿…è¦ãªäººæ•°ã‚’å…¥åŠ›ã—ã¦ã€Œè¿½åŠ ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br>â€»å„ã‚¨ãƒªã‚¢ã®æ™‚é–“ã¯è‡ªç”±ã«å¤‰æ›´ã§ãã¾ã™ã€‚</p>

    <div class="time-zone-grid">

      <div class="zone-card zone-morning">
        <div class="zone-title">â˜€ï¸ æœãƒ»é–‹åº—æº–å‚™</div>
        <form action="{{ url_for('makeshift.add_demand') }}" method="POST">
          <div style="display:flex; gap:10px;">
            <div class="form-row" style="flex:1;">
              <label>é–‹å§‹</label>
              <input type="time" name="start_time" value="09:00">
            </div>
            <div class="form-row" style="flex:1;">
              <label>çµ‚äº†</label>
              <input type="time" name="end_time" value="11:00">
            </div>
          </div>
          <div class="form-row">
            <label>å½¹å‰²</label>
            <select name="position_id">
                {% for pos in positions %}
                  <option value="{{ pos.id }}" {% if pos.id == 2 %}selected{% endif %}>{{ pos.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-row">
            <label>äººæ•°</label>
            <input type="number" name="required_count" min="0" value="1">
          </div>
          <button type="submit" class="add-btn" style="background:#4caf50;">ï¼‹ æœã®è¨­å®šã‚’è¿½åŠ </button>
        </form>
      </div>

      <div class="zone-card zone-lunch">
        <div class="zone-title">ğŸ” æ˜¼ãƒ»ãƒ©ãƒ³ãƒãƒ”ãƒ¼ã‚¯</div>
        <form action="{{ url_for('makeshift.add_demand') }}" method="POST">
          <div style="display:flex; gap:10px;">
            <div class="form-row" style="flex:1;">
              <label>é–‹å§‹</label>
              <input type="time" name="start_time" value="11:30">
            </div>
            <div class="form-row" style="flex:1;">
              <label>çµ‚äº†</label>
              <input type="time" name="end_time" value="14:00">
            </div>
          </div>
          <div class="form-row">
            <label>å½¹å‰²</label>
            <select name="position_id">
                {% for pos in positions %}
                  <option value="{{ pos.id }}">{{ pos.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-row">
            <label>äººæ•°</label>
            <input type="number" name="required_count" min="0" value="3">
          </div>
          <button type="submit" class="add-btn" style="background:#ff9800;">ï¼‹ æ˜¼ã®è¨­å®šã‚’è¿½åŠ </button>
        </form>
      </div>

      <div class="zone-card zone-idle">
        <div class="zone-title">â˜•ï¸ 15æ™‚ãƒ»ã‚¢ã‚¤ãƒ‰ãƒ«</div>
        <form action="{{ url_for('makeshift.add_demand') }}" method="POST">
          <div style="display:flex; gap:10px;">
            <div class="form-row" style="flex:1;">
              <label>é–‹å§‹</label>
              <input type="time" name="start_time" value="15:00">
            </div>
            <div class="form-row" style="flex:1;">
              <label>çµ‚äº†</label>
              <input type="time" name="end_time" value="17:00">
            </div>
          </div>
          <div class="form-row">
            <label>å½¹å‰²</label>
            <select name="position_id">
                {% for pos in positions %}
                  <option value="{{ pos.id }}">{{ pos.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-row">
            <label>äººæ•°</label>
            <input type="number" name="required_count" min="0" value="1">
          </div>
          <button type="submit" class="add-btn" style="background:#9e9e9e;">ï¼‹ ä¼‘æ†©æ™‚é–“ã®è¨­å®šã‚’è¿½åŠ </button>
        </form>
      </div>

      <div class="zone-card zone-night">
        <div class="zone-title">ğŸ» å¤œãƒ»ãƒ‡ã‚£ãƒŠãƒ¼</div>
        <form action="{{ url_for('makeshift.add_demand') }}" method="POST">
          <div style="display:flex; gap:10px;">
            <div class="form-row" style="flex:1;">
              <label>é–‹å§‹</label>
              <input type="time" name="start_time" value="18:00">
            </div>
            <div class="form-row" style="flex:1;">
              <label>çµ‚äº†</label>
              <input type="time" name="end_time" value="22:00">
            </div>
          </div>
          <div class="form-row">
            <label>å½¹å‰²</label>
            <select name="position_id">
                {% for pos in positions %}
                  <option value="{{ pos.id }}">{{ pos.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-row">
            <label>äººæ•°</label>
            <input type="number" name="required_count" min="0" value="4">
          </div>
          <button type="submit" class="add-btn" style="background:#3f51b5;">ï¼‹ å¤œã®è¨­å®šã‚’è¿½åŠ </button>
        </form>
      </div>

    </div>

    <div class="demand-list">
      <h3>ğŸ“Š ç¾åœ¨ä¿å­˜ã•ã‚Œã¦ã„ã‚‹è¨­å®šä¸€è¦§</h3>
      <div style="max-height: 300px; overflow-y: auto;">
        <table>
          <thead>
            <tr>
              <th>æ™‚é–“å¸¯</th>
              <th>å½¹å‰²</th>
              <th>å¿…è¦äººæ•°</th>
            </tr>
          </thead>
          <tbody>
            {% for d in demands %}
            <tr>
              <td>{{ d.time_slot }}</td>
              <td>
                {% if 'ã‚­ãƒƒãƒãƒ³' in d.position_name %}
                  <span style="color:#d32f2f; font-weight:bold;">ğŸ³ {{ d.position_name }}</span>
                {% elif 'ãƒ›ãƒ¼ãƒ«' in d.position_name %}
                  <span style="color:#1976d2; font-weight:bold;">ğŸ›ï¸ {{ d.position_name }}</span>
                {% else %}
                  {{ d.position_name }}
                {% endif %}
              </td>
              <td><b>{{ d.required_count }}</b> å</td>
            </tr>
            {% else %}
            <tr><td colspan="3" style="text-align:center; color:#aaa;">è¨­å®šãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <form action="{{ url_for('makeshift.reset_demand') }}" method="POST" style="margin-top:20px; text-align:right;">
        <button type="submit" class="btn" style="background:#d32f2f; color:white; padding:8px 16px; border:none; border-radius:4px; cursor:pointer;" onclick="return confirm('ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')">ğŸ—‘ å…¨ã¦å‰Šé™¤ã—ã¦ãƒªã‚»ãƒƒãƒˆ</button>
      </form>
    </div>
    
    <div style="margin-top:30px; text-align:center;">
        <a href="#" onclick="document.getElementById('basicSettings').style.display='block'; return false;" style="color:#666;">â–¼ åŸºæœ¬è¨­å®šï¼ˆé–‹åº—æ™‚é–“ãªã©ï¼‰ã‚’è¡¨ç¤º</a>
    </div>
    
    <div id="basicSettings" style="display:none; margin-top:20px; background:#f5f5f5; padding:20px; border-radius:8px;">
        <h3>åŸºæœ¬ãƒ«ãƒ¼ãƒ«è¨­å®š</h3>
        <form method="POST" action="{{ url_for('makeshift.settings') }}">
             <div style="display:flex; gap:20px; justify-content:center; align-items:center;">
                 <div><label>é–‹åº—ï¼š</label><input type="time" name="start_time" value="{{ settings.start_time }}"></div>
                 <div><label>é–‰åº—ï¼š</label><input type="time" name="end_time" value="{{ settings.end_time }}"></div>
                 <input type="hidden" name="max_hours_per_day" value="{{ settings.max_hours_per_day }}">
                 <button type="submit" style="padding:5px 15px;">ä¿å­˜</button>
             </div>
        </form>
    </div>

  </div>
</body>
</html>