<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸Œæœ›å…¥åŠ› | ShiftForm</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/sinsei.css') }}">
</head>
<body>
  <div class="overlay"></div>

  <div class="container">
    <h1 class="title"><span class="logo">M</span>{{ date }} ã®å¸Œæœ›å…¥åŠ›</h1>
    
    <!-- ğŸ”¹ æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="date-navigation">
      <a href="{{ url_for('calendar.sinsei', date=prev_date) }}" 
         class="nav-button"
         {% if prev_date_locked %}style="pointer-events: none; background: #333; color: #666; box-shadow: none;"{% endif %}>
        â† å‰æ—¥ ({{ prev_date_display }})
      </a>
      
      <span class="current-date">{{ date }}</span>
      
      <a href="{{ url_for('calendar.sinsei', date=next_date) }}" 
         class="nav-button"
         {% if next_date_locked %}style="pointer-events: none; background: #333; color: #666; box-shadow: none;"{% endif %}>
        æ¬¡æ—¥ ({{ next_date_display }}) â†’
      </a>
    </div>
    
    {% if is_locked %}
      <div style="background:#f8d7da; color:#721c24; padding:15px; border-radius:5px; margin-bottom:15px; border:1px solid #f5c6cb;">
        <strong>â›” ç·¨é›†ä¸å¯</strong><br>
        æå‡ºæœŸé™ï¼ˆæ¯æœˆ{{ deadline_day }}æ—¥ï¼‰ã‚’éãã¦ã„ã‚‹ã‹ã€éå»ã®æ—¥ä»˜ã®ãŸã‚å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚
      </div>
    {% else %}
      <div style="background:#d1ecf1; color:#0c5460; padding:15px; border-radius:5px; margin-bottom:15px; border:1px solid #bee5eb;">
        <strong>âœ… æå‡ºå¯èƒ½</strong><br>
        æå‡ºæœŸé™å†…ã§ã™ã€‚å¸Œæœ›ã‚·ãƒ•ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
      </div>
    {% endif %}
    
    {% if notice %}
    <div style="background:#ff7979; padding:15px; margin-bottom:20px; border-radius:8px; border:1px solid #ccc;">
      <strong>åº—èˆ—ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›:</strong> {{ notice }}
    </div>
    {% endif %}
    
    <div id="shift-settings" 
         data-min-hours="{{ min_hours }}"
         data-start-limit="{{ start_limit }}"
         data-end-limit="{{ end_limit }}">
    </div>

    <form method="POST" class="form-card" onsubmit="return validateForm()">
      <input type="hidden" name="date" value="{{ date }}">
      <input type="hidden" id="saveAction" name="save_action" value="return">

      <div class="form-group">
        <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
        <input type="text" name="name" value="{{ session.get('user_id', '') }}" readonly>
      </div>

      <div class="form-group">
        <label>å‡ºå‹¤æœ‰ç„¡</label>
        <select id="workSelect" name="work" onchange="toggleTimeInputs()" {% if is_locked %}disabled{% endif %}>
          <option value="1" {% if current_data and current_data.type == '1' %}selected{% endif %}>â—‹ å‡ºå‹¤å¯èƒ½</option>
          <option value="0" {% if current_data and current_data.type == '0' %}selected{% endif %}>Ã— å‡ºå‹¤ä¸å¯</option>
        </select>
      </div>

      <div class="form-group">
        <label>é–‹å§‹æ™‚é–“</label>
        <input type="time" id="startTime" name="start_time" 
               min="{{ start_limit }}" max="{{ end_limit }}" 
               value="{{ current_data.start_time if current_data else '' }}"
               {% if is_locked %}disabled{% endif %} required>
        <small style="color:#999; font-size:0.85em; display:block; margin-top:5px;">å¯èƒ½ç¯„å›²: {{ start_limit }} ã€œ {{ end_limit }}</small>
      </div>

      <div class="form-group">
        <label>çµ‚äº†æ™‚é–“</label>
        <input type="time" id="endTime" name="end_time" 
               min="{{ start_limit }}" max="{{ end_limit }}" 
               value="{{ current_data.end_time if current_data else '' }}"
               {% if is_locked %}disabled{% endif %} required>
        <small style="color:#999; font-size:0.85em; display:block; margin-top:5px;">æœ€ä½å‹¤å‹™æ™‚é–“: {{ min_hours }} æ™‚é–“</small>
      </div>

      {% if is_locked %}
        <button type="button" class="btn" style="background-color: #555; cursor: not-allowed;" disabled>æœŸé™åˆ‡ã‚Œã®ãŸã‚ä¿å­˜ã§ãã¾ã›ã‚“</button>
      {% else %}
        <div class="save-options">
          <button type="submit" class="btn" onclick="setSaveAction('return')">ğŸ’¾ ä¿å­˜ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸æˆ»ã‚‹</button>
          {% if not next_date_locked %}
          <button type="submit" class="btn btn-secondary" onclick="setSaveAction('next')">ä¿å­˜ã—ã¦æ¬¡ã®æ—¥ã¸ â†’</button>
          {% endif %}
        </div>
      {% endif %}
      
    </form>

    <!-- å¾Œã§ç”³è«‹ã™ã‚‹ãƒœã‚¿ãƒ³ -->
    <a href="{{ url_for('calendar.calendar', month=date[:7]) }}" class="btn-later">å¾Œã§ç”³è«‹ã™ã‚‹</a>
  </div>

  <script src="{{ url_for('static', filename='js/shinsei.js') }}"></script>
  <script>
    // ä¿å­˜ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š
    function setSaveAction(action) {
      document.getElementById('saveAction').value = action;
      return true; // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ç¶™ç¶š
    }
  </script>
</body>
</html>